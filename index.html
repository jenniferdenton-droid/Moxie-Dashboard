<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moxie Dashboard</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f5f7f8;
    color: #333;
    min-height: 100vh;
  }

  /* HEADER */
  header {
    background: white;
    border-bottom: 2px solid #4E8D99;
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .logo-area img {
    height: 36px;
    object-fit: contain;
  }

  .dashboard-title {
    font-size: 22px;
    font-weight: 700;
    color: #4E8D99;
    letter-spacing: -0.5px;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .search-box {
    padding: 8px 16px;
    border: 1.5px solid #ddd;
    border-radius: 24px;
    font-size: 14px;
    width: 220px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-box:focus { border-color: #4E8D99; }

  .add-btn {
    background: #4E8D99;
    color: white;
    border: none;
    padding: 9px 20px;
    border-radius: 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .add-btn:hover { background: #3d7480; }

  /* MAIN */
  main {
    max-width: 1300px;
    margin: 0 auto;
    padding: 32px 24px;
  }

  /* CATEGORY SECTION */
  .category-section {
    margin-bottom: 40px;
  }

  .category-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
    padding-bottom: 10px;
    border-bottom: 2px solid #EBBA95;
  }

  .category-icon { font-size: 20px; }

  .category-name {
    font-size: 17px;
    font-weight: 700;
    color: #6D445E;
    letter-spacing: 0.3px;
  }

  .category-count {
    background: #EBBA95;
    color: #6D445E;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 12px;
    margin-left: auto;
  }

  /* APP GRID */
  .app-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 16px;
  }

  /* APP CARD */
  .app-card {
    background: white;
    border-radius: 14px;
    padding: 20px 12px 16px;
    text-align: center;
    cursor: pointer;
    border: 1.5px solid #eee;
    transition: all 0.2s ease;
    position: relative;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  .app-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(78,141,153,0.15);
    border-color: #4E8D99;
  }

  .app-card-menu {
    position: absolute;
    top: 8px;
    right: 8px;
    background: none;
    border: none;
    cursor: pointer;
    color: #aaa;
    font-size: 16px;
    padding: 2px 6px;
    border-radius: 6px;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .app-card:hover .app-card-menu { opacity: 1; }
  .app-card-menu:hover { background: #f0f0f0; color: #333; }

  .app-icon {
    width: 52px;
    height: 52px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background: #f5f7f8;
    flex-shrink: 0;
  }

  .app-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 10px;
  }

  .app-icon .emoji-icon {
    font-size: 28px;
    line-height: 1;
  }

  .app-name {
    font-size: 12px;
    font-weight: 600;
    color: #444;
    line-height: 1.3;
    word-break: break-word;
  }

  /* CONTEXT MENU */
  .context-menu {
    position: fixed;
    background: white;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    z-index: 1000;
    min-width: 160px;
    overflow: hidden;
    display: none;
  }

  .context-menu button {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 11px 16px;
    background: none;
    border: none;
    text-align: left;
    font-size: 13px;
    cursor: pointer;
    color: #333;
    transition: background 0.15s;
  }

  .context-menu button:hover { background: #f5f7f8; }
  .context-menu button.danger { color: #e53e3e; }
  .context-menu button.danger:hover { background: #fff5f5; }

  .context-divider {
    height: 1px;
    background: #eee;
    margin: 4px 0;
  }

  /* MODAL OVERLAY */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 200;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.active { display: flex; }

  .modal {
    background: white;
    border-radius: 18px;
    padding: 32px;
    width: 90%;
    max-width: 480px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    position: relative;
  }

  .modal h2 {
    font-size: 20px;
    font-weight: 700;
    color: #4E8D99;
    margin-bottom: 24px;
  }

  .modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    background: #f0f0f0;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
  }

  .modal-close:hover { background: #e0e0e0; }

  .form-group {
    margin-bottom: 18px;
  }

  .form-group label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: #555;
    margin-bottom: 6px;
  }

  .form-group input,
  .form-group select {
    width: 100%;
    padding: 10px 14px;
    border: 1.5px solid #ddd;
    border-radius: 10px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
    color: #333;
    background: white;
  }

  .form-group input:focus,
  .form-group select:focus { border-color: #4E8D99; }

  .icon-preview {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 8px;
  }

  .icon-preview-box {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    background: #f5f7f8;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1.5px solid #eee;
    overflow: hidden;
    flex-shrink: 0;
  }

  .icon-preview-box img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .icon-preview-text { font-size: 12px; color: #888; }

  .modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 24px;
  }

  .btn-primary {
    flex: 1;
    background: #4E8D99;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
  }

  .btn-primary:hover { background: #3d7480; }

  .btn-secondary {
    background: #f0f0f0;
    color: #555;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .btn-secondary:hover { background: #e0e0e0; }

  /* ADD CATEGORY MODAL */
  .add-cat-btn {
    background: white;
    border: 2px dashed #EBBA95;
    color: #6D445E;
    padding: 10px 20px;
    border-radius: 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 32px;
  }

  .add-cat-btn:hover {
    background: #fdf6f0;
    border-color: #6D445E;
  }

  /* DRAG & DROP */
  .app-card.dragging {
    opacity: 0.4;
    border: 2px dashed #4E8D99;
  }

  .app-grid.drag-over {
    background: rgba(78,141,153,0.05);
    border-radius: 12px;
  }

  /* EMPTY STATE */
  .empty-grid {
    text-align: center;
    padding: 32px;
    color: #aaa;
    font-size: 14px;
    border: 2px dashed #eee;
    border-radius: 12px;
  }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: #333;
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 14px;
    z-index: 9999;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s;
    pointer-events: none;
  }

  .toast.show {
    opacity: 1;
    transform: translateY(0);
  }

  /* RESPONSIVE */
  @media (max-width: 600px) {
    header { padding: 12px 16px; flex-wrap: wrap; gap: 10px; }
    .search-box { width: 100%; }
    main { padding: 20px 12px; }
    .app-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo-area">
    <img src="https://raw.githubusercontent.com/jenniferdenton-droid/Moxie-Dashboard/main/moxie-logo.png"
         onerror="this.style.display='none'"
         alt="Moxie Logo">
    <span class="dashboard-title">Moxie Dashboard</span>
  </div>
  <div class="header-right">
    <input class="search-box" type="text" placeholder="ğŸ” Search apps..." id="searchInput" oninput="filterApps()">
    <button class="add-btn" onclick="openAddModal()">ï¼‹ Add App</button>
  </div>
</header>

<!-- MAIN -->
<main id="mainContent">
  <!-- Categories rendered by JS -->
</main>

<!-- ADD CATEGORY BUTTON (rendered inside main by JS) -->

<!-- CONTEXT MENU -->
<div class="context-menu" id="contextMenu">
  <button onclick="editApp()">âœï¸ Edit</button>
  <button onclick="moveApp()">ğŸ“‚ Move to Category</button>
  <div class="context-divider"></div>
  <button class="danger" onclick="deleteApp()">ğŸ—‘ï¸ Delete</button>
</div>

<!-- ADD/EDIT APP MODAL -->
<div class="modal-overlay" id="appModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('appModal')">Ã—</button>
    <h2 id="modalTitle">Add New App</h2>

    <div class="form-group">
      <label>App Name *</label>
      <input type="text" id="appName" placeholder="e.g. Gmail">
    </div>

    <div class="form-group">
      <label>URL *</label>
      <input type="url" id="appUrl" placeholder="https://...">
    </div>

    <div class="form-group">
      <label>Category *</label>
      <select id="appCategory"></select>
    </div>

    <div class="form-group">
      <label>Logo URL <span style="color:#aaa;font-weight:400">(optional â€” leave blank for auto)</span></label>
      <input type="url" id="appIcon" placeholder="https://...logo.png" oninput="previewIcon()">
      <div class="icon-preview">
        <div class="icon-preview-box" id="iconPreviewBox">
          <span style="font-size:22px">ğŸŒ</span>
        </div>
        <span class="icon-preview-text">Logo preview</span>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('appModal')">Cancel</button>
      <button class="btn-primary" onclick="saveApp()">Save App</button>
    </div>
  </div>
</div>

<!-- ADD CATEGORY MODAL -->
<div class="modal-overlay" id="catModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('catModal')">Ã—</button>
    <h2>New Category</h2>

    <div class="form-group">
      <label>Category Name *</label>
      <input type="text" id="catName" placeholder="e.g. Design Tools">
    </div>

    <div class="form-group">
      <label>Emoji Icon</label>
      <input type="text" id="catEmoji" placeholder="e.g. ğŸ¨" maxlength="4">
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('catModal')">Cancel</button>
      <button class="btn-primary" onclick="saveCategory()">Save Category</button>
    </div>
  </div>
</div>

<!-- MOVE APP MODAL -->
<div class="modal-overlay" id="moveModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('moveModal')">Ã—</button>
    <h2>Move App</h2>
    <div class="form-group">
      <label>Choose Category</label>
      <select id="moveCategorySelect"></select>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('moveModal')">Cancel</button>
      <button class="btn-primary" onclick="confirmMove()">Move</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ DEFAULT DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const DEFAULT_CATEGORIES = [
  { id: 'communication', name: 'Communication', icon: 'ğŸ“¬' },
  { id: 'project',       name: 'Project Management', icon: 'ğŸ“‹' },
  { id: 'finance',       name: 'Finance', icon: 'ğŸ’°' },
  { id: 'sales',         name: 'Sales & CRM', icon: 'ğŸ›’' },
  { id: 'operations',    name: 'Operations', icon: 'ğŸ”§' },
  { id: 'ai',            name: 'AI Tools', icon: 'ğŸ¤–' }
];

const DEFAULT_APPS = [
  // Communication
  { id: 'gmail',    name: 'Gmail',          url: 'https://mail.google.com',       icon: 'https://www.gstatic.com/images/branding/product/2x/gmail_2020q4_512dp.png',                   category: 'communication' },
  { id: 'meet',     name: 'Google Meet',    url: 'https://meet.google.com',       icon: 'https://fonts.gstatic.com/s/i/productlogos/meet_2020q4/v1/web-512dp/logo_meet_2020q4_color_2x_web_512dp.png', category: 'communication' },
  { id: 'slack',    name: 'Slack',          url: 'https://slack.com',             icon: 'https://a.slack-edge.com/80588/marketing/img/meta/slack_hash_128.png',                          category: 'communication' },
  { id: 'loom',     name: 'Loom',           url: 'https://www.loom.com',          icon: 'https://cdn.loom.com/assets/img/og/loom-share.png',                                             category: 'communication' },
  { id: 'fathom',   name: 'Fathom',         url: 'https://fathom.video/home',     icon: 'https://fathom.video/favicon.ico',                                                              category: 'communication' },

  // Project Management
  { id: 'asana',    name: 'Asana',          url: 'https://app.asana.com/1/1203386861136560/home', icon: 'https://luna1.co/7d4500.png',                                                    category: 'project' },
  { id: 'notion',   name: 'Notion',         url: 'https://www.notion.so/moxie-docs/6060ef49fea04dc3a1dc0a32d0564233', icon: 'https://www.notion.so/images/favicon.ico',                 category: 'project' },
  { id: 'arrows',   name: 'Arrows',         url: 'https://success.joinmoxie.com/home', icon: 'https://success.joinmoxie.com/favicon.ico',                                                category: 'project' },
  { id: 'gcal',     name: 'Google Calendar',url: 'https://calendar.google.com',   icon: 'https://calendar.google.com/googlecalendar/images/favicons_2020q4/calendar_2020q4_favicon2x.ico', category: 'project' },
  { id: 'gsheets',  name: 'Google Sheets',  url: 'https://sheets.google.com',     icon: 'https://www.gstatic.com/images/branding/product/2x/sheets_2020q4_512dp.png',                   category: 'project' },

  // Finance
  { id: 'ramp',     name: 'Ramp',           url: 'https://app.ramp.com/sign-in',  icon: 'https://ramp.com/favicon.ico',                                                                  category: 'finance' },
  { id: 'stripe',   name: 'Stripe',         url: 'https://dashboard.stripe.com/register?account_invite=uis_sSEYJeeK7OA10mzCAF69eIyxWICgGRPI', icon: 'https://stripe.com/favicon.ico',  category: 'finance' },
  { id: 'justworks',name: 'JustWorks',      url: 'https://payroll.justworks.com/account/vouchers', icon: 'https://justworks.com/favicon.ico',                                             category: 'finance' },

  // Sales & CRM
  { id: 'hubspot',  name: 'HubSpot',        url: 'https://app.hubspot.com/login/?loginRedirectUrl=https%3A%2F%2Fapp.hubspot.com%2Fcontacts%2F22420370%2Fobjects%2F0-1%2Fviews%2Fall%2Flist&loginPortalId=22420370', icon: 'https://www.hubspot.com/hubfs/assets/hubspot.com/buzz/HubSpotOpenGraph.png', category: 'sales' },
  { id: 'shopify',  name: 'Shopify',        url: 'https://admin.shopify.com/store/moxie-9681', icon: 'https://cdn.shopify.com/shopifycloud/brochure/assets/brand-assets/shopify-logo-primary-logo-616ac4f57cc92b13e9f40c2b7d2f3f3c.svg', category: 'sales' },

  // Operations
  { id: 'omni',     name: 'Omni',           url: 'https://moxie.omniapp.co',      icon: 'https://moxie.omniapp.co/favicon.ico',                                                          category: 'operations' },
  { id: 'glean',    name: 'Glean',          url: 'https://app.glean.com/?qe=https%3A%2F%2Fjoinmoxie-be.glean.com&utm_source=admin_invite&utm_medium=email&utm_campaign=vanity_v3&skip_to_sso=1&setup=welcome', icon: 'https://app.glean.com/favicon.ico', category: 'operations' },
  { id: '1password',name: '1Password',      url: 'https://my.1password.com',      icon: 'https://1password.com/img/social-sharing-logo.png',                                             category: 'operations' },
  { id: 'dropbox',  name: 'Dropbox Sign',   url: 'https://app.hellosign.com/account/logIn', icon: 'https://app.hellosign.com/favicon.ico',                                               category: 'operations' },
  { id: 'zapier',   name: 'Zapier',         url: 'https://zapier.com',            icon: 'https://cdn.zapier.com/zapier/images/favicon.ico',                                              category: 'operations' },
  { id: 'github',   name: 'GitHub',         url: 'https://github.com',            icon: 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png',                     category: 'operations' },
  { id: 'moxieadmin',name:'Moxie Admin',    url: 'https://api.prod.internal.joinmoxie.com/admin/login/', icon: 'ğŸ”',                                                                     category: 'operations' },

  // AI
  { id: 'chatgpt',  name: 'ChatGPT',        url: 'https://chatgpt.com',           icon: 'https://cdn.oaistatic.com/_next/static/media/favicon-32x32.be48395e.png',                      category: 'ai' }
];

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let categories = [];
let apps = [];
let editingAppId = null;
let contextAppId = null;
let dragSrcId = null;

// â”€â”€â”€ STORAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function loadData() {
  const savedCats = localStorage.getItem('moxie_categories');
  const savedApps = localStorage.getItem('moxie_apps');

  if (savedCats) {
    categories = JSON.parse(savedCats);
  } else {
    categories = JSON.parse(JSON.stringify(DEFAULT_CATEGORIES));
    saveCategories();
  }

  if (savedApps) {
    apps = JSON.parse(savedApps);
  } else {
    apps = JSON.parse(JSON.stringify(DEFAULT_APPS));
    saveApps();
  }
}

function saveCategories() {
  localStorage.setItem('moxie_categories', JSON.stringify(categories));
}

function saveApps() {
  localStorage.setItem('moxie_apps', JSON.stringify(apps));
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function render(filter = '') {
  const main = document.getElementById('mainContent');
  main.innerHTML = '';

  // Add Category button
  const addCatBtn = document.createElement('button');
  addCatBtn.className = 'add-cat-btn';
  addCatBtn.textContent = 'ï¼‹ Add Category';
  addCatBtn.onclick = () => openModal('catModal');
  main.appendChild(addCatBtn);

  const query = filter.toLowerCase().trim();

  categories.forEach(cat => {
    const catApps = apps.filter(a => a.category === cat.id &&
      (query === '' || a.name.toLowerCase().includes(query)));

    if (query && catApps.length === 0) return;

    const section = document.createElement('div');
    section.className = 'category-section';
    section.dataset.catId = cat.id;

    section.innerHTML = `
      <div class="category-header">
        <span class="category-icon">${cat.icon}</span>
        <span class="category-name">${cat.name}</span>
        <span class="category-count">${catApps.length}</span>
      </div>
      <div class="app-grid" id="grid-${cat.id}" data-cat="${cat.id}"></div>
    `;

    main.appendChild(section);

    const grid = section.querySelector(`#grid-${cat.id}`);

    if (catApps.length === 0) {
      grid.innerHTML = '<div class="empty-grid">No apps yet â€” click ï¼‹ Add App</div>';
    } else {
      catApps.forEach(app => grid.appendChild(createCard(app)));
    }

    // Drag-over highlight
    grid.addEventListener('dragover', e => {
      e.preventDefault();
      grid.classList.add('drag-over');
    });

    grid.addEventListener('dragleave', () => grid.classList.remove('drag-over'));

    grid.addEventListener('drop', e => {
      e.preventDefault();
      grid.classList.remove('drag-over');
      if (dragSrcId && dragSrcId !== cat.id + '') {
        const idx = apps.findIndex(a => a.id === dragSrcId);
        if (idx > -1) {
          apps[idx].category = cat.id;
          saveApps();
          showToast(`Moved to ${cat.name}`);
          render(document.getElementById('searchInput').value);
        }
      }
    });
  });
}

function createCard(app) {
  const card = document.createElement('div');
  card.className = 'app-card';
  card.draggable = true;
  card.dataset.appId = app.id;

  const iconHtml = buildIconHtml(app.icon, app.name);

  card.innerHTML = `
    <button class="app-card-menu" title="Options" onclick="openContextMenu(event, '${app.id}')">â‹¯</button>
    <div class="app-icon">${iconHtml}</div>
    <span class="app-name">${app.name}</span>
  `;

  // Click to open (but not on menu button)
  card.addEventListener('click', e => {
    if (e.target.classList.contains('app-card-menu')) return;
    window.open(app.url, '_blank');
  });

  // Drag
  card.addEventListener('dragstart', () => {
    dragSrcId = app.id;
    setTimeout(() => card.classList.add('dragging'), 0);
  });

  card.addEventListener('dragend', () => {
    card.classList.remove('dragging');
    dragSrcId = null;
  });

  return card;
}

function buildIconHtml(icon, name) {
  if (!icon) {
    return `<span class="emoji-icon">ğŸŒ</span>`;
  }
  if (icon.startsWith('http') || icon.startsWith('data:')) {
    return `<img src="${icon}" alt="${name}" onerror="this.parentElement.innerHTML='<span class=\\'emoji-icon\\'>ğŸŒ</span>'">`;
  }
  // It's an emoji or text
  return `<span class="emoji-icon">${icon}</span>`;
}

// â”€â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function filterApps() {
  const q = document.getElementById('searchInput').value;
  render(q);
}

// â”€â”€â”€ ADD/EDIT APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function openAddModal() {
  editingAppId = null;
  document.getElementById('modalTitle').textContent = 'Add New App';
  document.getElementById('appName').value = '';
  document.getElementById('appUrl').value = '';
  document.getElementById('appIcon').value = '';
  document.getElementById('iconPreviewBox').innerHTML = '<span style="font-size:22px">ğŸŒ</span>';
  populateCategorySelect('appCategory');
  openModal('appModal');
}

function editApp() {
  closeContextMenu();
  const app = apps.find(a => a.id === contextAppId);
  if (!app) return;

  editingAppId = app.id;
  document.getElementById('modalTitle').textContent = 'Edit App';
  document.getElementById('appName').value = app.name;
  document.getElementById('appUrl').value = app.url;
  document.getElementById('appIcon').value = app.icon || '';
  previewIcon();
  populateCategorySelect('appCategory', app.category);
  openModal('appModal');
}

function saveApp() {
  const name = document.getElementById('appName').value.trim();
  const url  = document.getElementById('appUrl').value.trim();
  const icon = document.getElementById('appIcon').value.trim();
  const category = document.getElementById('appCategory').value;

  if (!name || !url) { showToast('âš ï¸ Name and URL are required'); return; }
  if (!url.startsWith('http')) { showToast('âš ï¸ URL must start with https://'); return; }
  if (!category) { showToast('âš ï¸ Please select a category'); return; }

  if (editingAppId) {
    const idx = apps.findIndex(a => a.id === editingAppId);
    if (idx > -1) {
      apps[idx] = { ...apps[idx], name, url, icon, category };
      showToast('âœ… App updated!');
    }
  } else {
    const newApp = {
      id: 'app_' + Date.now(),
      name, url, icon, category
    };
    apps.push(newApp);
    showToast('âœ… App added!');
  }

  saveApps();
  closeModal('appModal');
  render(document.getElementById('searchInput').value);
}

function deleteApp() {
  closeContextMenu();
  if (!contextAppId) return;
  const app = apps.find(a => a.id === contextAppId);
  if (!app) return;
  if (!confirm(`Delete "${app.name}"?`)) return;
  apps = apps.filter(a => a.id !== contextAppId);
  saveApps();
  showToast('ğŸ—‘ï¸ App deleted');
  render(document.getElementById('searchInput').value);
}

// â”€â”€â”€ MOVE APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function moveApp() {
  closeContextMenu();
  populateCategorySelect('moveCategorySelect');
  openModal('moveModal');
}

function confirmMove() {
  const newCat = document.getElementById('moveCategorySelect').value;
  const idx = apps.findIndex(a => a.id === contextAppId);
  if (idx > -1 && newCat) {
    apps[idx].category = newCat;
    saveApps();
    const cat = categories.find(c => c.id === newCat);
    showToast(`Moved to ${cat ? cat.name : newCat}`);
    closeModal('moveModal');
    render(document.getElementById('searchInput').value);
  }
}

// â”€â”€â”€ ADD CATEGORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function saveCategory() {
  const name  = document.getElementById('catName').value.trim();
  const emoji = document.getElementById('catEmoji').value.trim() || 'ğŸ“';

  if (!name) { showToast('âš ï¸ Category name required'); return; }

  const id = 'cat_' + Date.now();
  categories.push({ id, name, icon: emoji });
  saveCategories();
  showToast(`âœ… Category "${name}" added`);
  closeModal('catModal');
  render(document.getElementById('searchInput').value);
}

// â”€â”€â”€ CONTEXT MENU â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function openContextMenu(e, appId) {
  e.stopPropagation();
  e.preventDefault();
  contextAppId = appId;

  const menu = document.getElementById('contextMenu');
  menu.style.display = 'block';

  const x = Math.min(e.clientX, window.innerWidth - 180);
  const y = Math.min(e.clientY, window.innerHeight - 150);
  menu.style.left = x + 'px';
  menu.style.top  = y + 'px';
}

function closeContextMenu() {
  document.getElementById('contextMenu').style.display = 'none';
}

document.addEventListener('click', closeContextMenu);

// â”€â”€â”€ ICON PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function previewIcon() {
  const val = document.getElementById('appIcon').value.trim();
  const box = document.getElementById('iconPreviewBox');
  if (val.startsWith('http') || val.startsWith('data:')) {
    box.innerHTML = `<img src="${val}" onerror="this.parentElement.innerHTML='<span style=\\'font-size:22px\\'>ğŸŒ</span>'">`;
  } else if (val) {
    box.innerHTML = `<span style="font-size:22px">${val}</span>`;
  } else {
    box.innerHTML = '<span style="font-size:22px">ğŸŒ</span>';
  }
}

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function populateCategorySelect(selectId, selectedId = '') {
  const sel = document.getElementById(selectId);
  sel.innerHTML = categories.map(c =>
    `<option value="${c.id}" ${c.id === selectedId ? 'selected' : ''}>${c.icon} ${c.name}</option>`
  ).join('');
}

function openModal(id) {
  document.getElementById(id).classList.add('active');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

loadData();
render();
</script>
</body>
</html>
